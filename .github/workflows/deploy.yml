name: Auto Deploy to Server and Notify Discord

on:
  push:
    branches: [main]

jobs:
  deploy:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Deploy to Remote Server via SSH
        id: deploy
        uses: appleboy/ssh-action@v0.1.6
        with:
          host: ${{ secrets.SSH_HOST }}
          username: ${{ secrets.SSH_USER }}
          key: ${{ secrets.SSH_KEY }}
          script: |
            cd /home/hamyo/hamyo
            git pull origin main
            sudo systemctl restart hamyo.service

      - name: Notify Discord (with commit message)
        if: always()
        uses: Ilshidur/action-discord@master
        with:
          webhook: ${{ secrets.DISCORD_WEBHOOK }}
          args: |
            ${{ job.status == 'success' && 'âœ… **ìë™ ë°°í¬ ì„±ê³µ ğŸ‰**' || 'âŒ **ìë™ ë°°í¬ ì‹¤íŒ¨ âš ï¸**' }}
            â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
            â€¢ ì €ì¥ì†Œ: **${{ github.repository }}**
            â€¢ ë¸Œëœì¹˜: **${{ github.ref_name }}**
            â€¢ ì»¤ë°‹: [${{ github.sha }}](https://github.com/${{ github.repository }}/commit/${{ github.sha }})
            â€¢ ì‘ì„±ì: **${{ github.actor }}**
            â€¢ ë©”ì‹œì§€: 
              > ${{ github.event.head_commit.message }}
            â€¢ ìƒíƒœ: **${{ job.status }}**
            â€¢ ì„œë²„ ë´‡ ìë™ ì¬ì‹œì‘ ì™„ë£Œ ğŸ’«
